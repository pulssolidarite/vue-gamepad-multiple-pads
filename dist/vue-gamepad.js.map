{"version":3,"file":"vue-gamepad.js","sources":["../lib/utils.js","../lib/button-mapping.js","../lib/gamepad.js","../lib/index.js"],"sourcesContent":["/**\n * helper function to build all nested properties similar to lodash's _.set function\n *\n * set(object, ['x', 'y', 'z'], 'default')\n * console.log(object.x.y.z);\n *  => default\n *\n * @param {object} obj object to build properties for\n * @param {array} keys list of keys to nest\n * @param {any} value value to set\n */\nexport function set(obj, keys, value) {\n  /* eslint-disable no-param-reassign */\n  obj[keys[0]] = obj[keys[0]] || {};\n  const tmp = obj[keys[0]];\n\n  if (keys.length > 1) {\n    keys.shift();\n    set(tmp, keys, value);\n  } else {\n    obj[keys[0]] = value;\n  }\n\n  return obj;\n}\n\n/**\n * helper function to get value from a nest object similar to lodash's _.get function\n *\n * get({ x: { y: 0 } }, ['x', 'y', 'z'], [])\n * => []\n *\n * @param {object} obj object to get properties from\n * @param {array} keys list of keys to use\n * @param {any} [def=undefined] default value if nothing was found\n */\nexport function get(obj, keys, def = undefined) {\n  const tmp = obj[keys[0]];\n\n  if (keys.length > 1 && tmp) {\n    keys.shift();\n    return get(tmp, keys) || def;\n  }\n\n  return tmp || def;\n}\n","export const ButtonNames = [\n  'button-a', 'button-b', 'button-x', 'button-y',\n  'shoulder-left', 'shoulder-right', 'trigger-left', 'trigger-right',\n  'button-select', 'button-start',\n  'left-stick-in', 'right-stick-in',\n  'button-dpad-up', 'button-dpad-down', 'button-dpad-left', 'button-dpad-right',\n  'vendor',\n];\n\nexport const PositiveAxisNames = [\n  'left-analog-right', 'left-analog-down',\n  'right-analog-right', 'right-analog-down',\n];\n\nexport const NegativeAxisNames = [\n  'left-analog-left', 'left-analog-up',\n  'right-analog-left', 'right-analog-up',\n];\n\n/**\n * get name of axis from input value\n * @param {number} axis axis id\n * @param {number} value current input value\n * @return {string} string representing the axis name\n */\nexport function getAxisNameFromValue(axis, value) {\n  if (value > 0) return PositiveAxisNames[axis];\n  return NegativeAxisNames[axis];\n}\n\n/**\n * get the name of both position and negative names from an axis\n * @param {number} axis axis is\n * @return {array} array containing both position and negative axis names\n */\nexport function getAxisNames(axis) {\n  return [PositiveAxisNames[axis], NegativeAxisNames[axis]];\n}\n","import { set, get } from './utils';\nimport { getAxisNameFromValue, getAxisNames } from './button-mapping';\n\nexport default function (Vue, options = {}) {\n\treturn class Gamepad {\n\t\tconstructor() {\n\t\t\tthis.holding = {};\n\t\t\tthis.events = {};\n\t\t\tthis.layer = 0;\n\t\t\tthis.layers = {};\n\n\t\t\twindow.addEventListener('gamepadconnected', this.padConnected.bind(this));\n\t\t\twindow.addEventListener('gamepaddisconnected', this.padDisconnected.bind(this));\n\n\t\t\tthis.animationFrame = requestAnimationFrame(this.run.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * gamepad was connected\n\t\t */\n\t\tpadConnected() {\n\t\t\tdocument.body.classList.add('gamepad-connected');\n\t\t}\n\n\t\t/**\n\t\t * gamepad was disconnected\n\t\t */\n\t\tpadDisconnected() {\n\t\t\tif (this.getGamepads().length === 0) {\n\t\t\t\tdocument.body.classList.remove('gamepad-connected');\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * add an event handler\n\t\t * @param {string} event name of the button event\n\t\t * @param {object} modifiers vue binding modifiers\n\t\t * @param {function} callback function to trigger\n\t\t * @param {object} vnode vue directive vnode\n\t\t */\n\t\taddListener(event, modifiers, callback, vnode = null) {\n\t\t\tconst action = modifiers.released ? 'released' : 'pressed';\n\t\t\tconst repeat = !!modifiers.repeat;\n\n\t\t\t// if we don't already have an array initialised for the current event\n\t\t\t// do it now\n\t\t\tconst events = get(this.events, [this.layer, action, event], []);\n\t\t\tif (events.length === 0) {\n\t\t\t\tset(this.events, [this.layer, action, event], []);\n\t\t\t}\n\n\t\t\t// register the event\n\t\t\tthis.events[this.layer][action][event].push({ vnode, repeat, callback });\n\n\t\t\t// inject classes\n\t\t\tif (options.injectClasses && vnode && vnode.elm) {\n\t\t\t\tvnode.elm.classList.add('v-gamepad', `v-gamepad--${event}`);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * remove an event handler\n\t\t * @param {string} event name of the button event\n\t\t * @param {object} modifiers vue binding modifiers\n\t\t * @param {function} callback trigger function\n\t\t */\n\t\tremoveListener(event, modifiers, callback) {\n\t\t\tconst action = modifiers.released ? 'released' : 'pressed';\n\n\t\t\t// get a list of all events for the current action\n\t\t\tlet events = get(this.events, [this.layer, action, event], []);\n\t\t\tif (events.length > 0) {\n\t\t\t\t// filter any events which have same callback\n\t\t\t\tevents = events.filter((e) => e.callback !== callback);\n\n\t\t\t\t// if we have any remaining events after the filter, update the array\n\t\t\t\t// otherwise delete the object\n\t\t\t\tif (events.length > 0) {\n\t\t\t\t\tset(this.events, [this.layer, action, event], events);\n\t\t\t\t} else {\n\t\t\t\t\tdelete this.events[this.layer][action][event];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * switch to a new layer\n\t\t * @param {number} layer layer number to switch to\n\t\t */\n\t\tswitchToLayer(layer) {\n\t\t\tif (this.layer !== layer) {\n\t\t\t\t// keep track of the old layer before we switch\n\t\t\t\tthis.layers[layer] = this.layer;\n\t\t\t\tthis.layer = layer;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * remove a layer, delete the registered events and switch back to the old layer\n\t\t * @param {number} layer layer number to remove\n\t\t */\n\t\tremoveLayer(layer) {\n\t\t\t// switch back to the previous layer\n\t\t\tthis.layer = this.layers[layer];\n\t\t\tdelete this.layers[layer];\n\n\t\t\t// delete the layer events\n\t\t\tdelete this.events[layer];\n\t\t}\n\n\t\t/**\n\t\t * main loop\n\t\t */\n\t\trun() {\n\t\t\tvar gamepads = this.getGamepads();\n\t\t\tif (gamepads.length > 1) {\n\t\t\t\tvar pad = gamepads[0];\n\t\t\t// this.getGamepads().forEach((pad) => {\n\t\t\t\t// check gamepad buttons\n\t\t\t\tpad.buttons.forEach((button, index) => {\n\t\t\t\t\tconst name = options.buttonNames[index];\n\n\t\t\t\t\t// button is pressed\n\t\t\t\t\tif (button.pressed) {\n\t\t\t\t\t\tconst events = get(this.events, [this.layer, \"pressed\", name], []);\n\n\t\t\t\t\t\tif (events.length > 0) {\n\t\t\t\t\t\t\tconst event = events[events.length - 1];\n\t\t\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\t\t\tconst initial = typeof this.holding[name] === \"undefined\";\n\n\t\t\t\t\t\t\t// button was just pressed, or is repeating\n\t\t\t\t\t\t\tif (initial || (event.repeat && now - this.holding[name] >= options.buttonRepeatTimeout)) {\n\t\t\t\t\t\t\t\tthis.holding[name] = now;\n\t\t\t\t\t\t\t\tif (initial) {\n\t\t\t\t\t\t\t\t\tthis.holding[name] += options.buttonInitialTimeout - options.buttonRepeatTimeout;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tevent.callback.call();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// button was released\n\t\t\t\t\t} else if (!button.pressed && typeof this.holding[name] !== \"undefined\") {\n\t\t\t\t\t\tdelete this.holding[name];\n\t\t\t\t\t\tconst events = get(this.events, [this.layer, \"released\", name], []);\n\n\t\t\t\t\t\tif (events.length > 0) {\n\t\t\t\t\t\t\tconst event = events[events.length - 1];\n\t\t\t\t\t\t\tevent.callback.call();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// check gamepad axis\n\t\t\t\tpad.axes.forEach((value, index) => {\n\t\t\t\t\tif (value >= options.analogThreshold || value <= -(options.analogThreshold)) {\n\t\t\t\t\t\tconst name = getAxisNameFromValue(index, value);\n\t\t\t\t\t\tconst events = get(this.events, [this.layer, 'pressed', name], []);\n\n\t\t\t\t\t\tif (events.length > 0) {\n\t\t\t\t\t\t\tconst event = events[events.length - 1];\n\t\t\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\t\t\tconst initial = typeof this.holding[name] === 'undefined';\n\n\t\t\t\t\t\t\t// axis was just moved, or is repeating\n\t\t\t\t\t\t\tif (initial || (event.repeat && (now - this.holding[name]) >= options.buttonRepeatTimeout)) {\n\t\t\t\t\t\t\t\tthis.holding[name] = now;\n\t\t\t\t\t\t\t\tif (initial) {\n\t\t\t\t\t\t\t\t\tthis.holding[name] += (options.buttonInitialTimeout - options.buttonRepeatTimeout);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tevent.callback.call();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst names = getAxisNames(index);\n\n\t\t\t\t\t\t// trigger the release event if this axis was previously pressed\n\t\t\t\t\t\tnames.filter((name) => this.holding[name]).forEach((name) => {\n\t\t\t\t\t\t\tdelete this.holding[name];\n\n\t\t\t\t\t\t\tconst events = get(this.events, [this.layer, 'released', name], []);\n\t\t\t\t\t\t\tif (events.length > 0) {\n\t\t\t\t\t\t\t\tconst event = events[events.length - 1];\n\t\t\t\t\t\t\t\tevent.callback.call();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t// });\n\t\t\t};\n\t\t\tthis.animationFrame = requestAnimationFrame(this.run.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * get an array of active gamepads\n\t\t * @return {array}\n\t\t */\n\t\tgetGamepads() {\n\t\t\treturn Array.from(navigator.getGamepads()).filter((pad) => pad !== null);\n\t\t}\n\n\t\t/**\n\t\t * helper function to test if a binding is valid\n\t\t * @param {object} binding binding to test which includes arg & value\n\t\t * @return {boolean}\n\t\t */\n\t\tisValidBinding(binding) {\n\t\t\treturn typeof binding.arg !== 'undefined' && (typeof binding.value === 'function' || (typeof binding.value === 'undefined' && typeof binding.expression === 'undefined'));\n\t\t}\n\t};\n}\n","import GamepadFactory from './gamepad';\nimport { ButtonNames } from './button-mapping';\n\nexport default {\n  /**\n   * install function\n   * @param {Vue} Vue\n   * @param {object} options\n   */\n  install(Vue, options = {}) {\n    // we need basic gamepad api support to work\n    if (!('getGamepads' in navigator)) {\n      console.error('vue-gamepad: your browser does not support the Gamepad API!');\n      return;\n    }\n\n    const DefaultOptions = {\n      analogThreshold: 0.5,\n      buttonNames: ButtonNames,\n      buttonRepeatTimeout: 200,\n      buttonInitialTimeout: 200,\n      injectClasses: true,\n    };\n\n    const Gamepad = GamepadFactory(Vue, { ...DefaultOptions, ...options });\n    const gamepad = new Gamepad();\n\n    /* eslint-disable no-param-reassign */\n    Vue.prototype.$gamepad = gamepad;\n\n    Vue.directive('gamepad', {\n      bind: (el, binding, vnode) => {\n        if (gamepad.isValidBinding(binding)) {\n          const callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\n          gamepad.addListener(binding.arg, binding.modifiers, callback, vnode);\n        } else {\n          console.error(`invalid binding. '${binding.arg}' was not bound.`);\n        }\n      },\n      unbind: (el, binding, vnode) => {\n        if (gamepad.isValidBinding(binding)) {\n          const callback = typeof binding.value !== 'undefined' ? binding.value : vnode.data.on.click;\n          gamepad.removeListener(binding.arg, binding.modifiers, callback);\n        } else {\n          console.error(`invalid binding. '${binding.arg}' was not unbound.`);\n        }\n      },\n    });\n\n    Vue.directive('gamepad-layer', {\n      bind: (el, binding) => gamepad.switchToLayer(binding.value),\n      unbind: (el, binding) => gamepad.removeLayer(binding.value),\n    });\n  },\n};\n"],"names":["set","obj","keys","value","tmp","length","shift","get","def","undefined","ButtonNames","PositiveAxisNames","NegativeAxisNames","getAxisNameFromValue","axis","getAxisNames","Vue","options","holding","events","layer","layers","window","addEventListener","padConnected","bind","padDisconnected","animationFrame","requestAnimationFrame","run","document","body","classList","add","getGamepads","remove","event","modifiers","callback","vnode","action","released","repeat","push","injectClasses","elm","filter","e","gamepads","pad","buttons","forEach","button","index","name","buttonNames","pressed","now","Date","initial","buttonRepeatTimeout","buttonInitialTimeout","call","axes","analogThreshold","names","Array","from","navigator","binding","arg","expression","install","console","error","DefaultOptions","Gamepad","GamepadFactory","gamepad","prototype","$gamepad","directive","el","isValidBinding","data","on","click","addListener","unbind","removeListener","switchToLayer","removeLayer"],"mappings":"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"}